# LiveVTT TTML Examples

This directory contains example files demonstrating TTML (Timed Text Markup Language) subtitle generation and conversion.

## Example Files

- **sample.ru.vtt** - Russian WebVTT subtitle file
- **sample.en.vtt** - English WebVTT subtitle file (translation)
- **sample.ttml** - Bilingual TTML file combining both languages

## TTML Format Overview

TTML files combine multiple subtitle tracks into a single XML document with proper language tagging. Each subtitle cue contains both languages:

```xml
<p begin="00:00:05.000" end="00:00:08.500">
    <span xml:lang="ru">Добро пожаловать в нашу программу.</span>
    <span xml:lang="en">Welcome to our program.</span>
</p>
```

## Generating TTML Files

### Option 1: During Archive Transcription (Default Behavior)

TTML generation is **enabled by default**. Simply run archive transcription:

```bash
python src/python/tools/archive_transcriber.py \
    /path/to/archive \
    --progress \
    --workers 4
```

This will generate:
- `video.ru.vtt` (Russian transcription)
- `video.en.vtt` (English translation)
- `video.ttml` (Bilingual TTML) **← Generated by default**
- `video.smil` (Wowza manifest with TTML reference)

#### Skip TTML Generation

To generate only VTT files without TTML:

```bash
python src/python/tools/archive_transcriber.py \
    /path/to/archive \
    --no-ttml \
    --progress
```

#### Use VTT Files in SMIL

By default, SMIL manifests reference the TTML file. To use individual VTT files instead:

```bash
python src/python/tools/archive_transcriber.py \
    /path/to/archive \
    --vtt-in-smil \
    --progress
```

### Option 2: Convert Existing VTT Files

Use the standalone converter to merge existing WebVTT files:

```bash
# Basic usage
python src/python/tools/vtt_to_ttml.py \
    --vtt_ru sample.ru.vtt \
    --vtt_en sample.en.vtt \
    --output sample.ttml

# With custom tolerance for timestamp alignment
python src/python/tools/vtt_to_ttml.py \
    --vtt_ru sample.ru.vtt \
    --vtt_en sample.en.vtt \
    --output sample.ttml \
    --tolerance 1.5 \
    --verbose

# Different language codes
python src/python/tools/vtt_to_ttml.py \
    --vtt_ru video.es.vtt \
    --vtt_en video.en.vtt \
    --output video.ttml \
    --lang1 es \
    --lang2 en
```

## TTML Structure

The generated TTML files follow W3C TTML1 specification:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<tt xmlns="http://www.w3.org/ns/ttml" xml:lang="ru">
  <body>
    <div>
      <p begin="HH:MM:SS.mmm" end="HH:MM:SS.mmm">
        <span xml:lang="ru">Russian text</span>
        <span xml:lang="en">English text</span>
      </p>
      <!-- More paragraphs... -->
    </div>
  </body>
</tt>
```

### Key Features

1. **Timestamp Alignment**: Cues from both VTT files are aligned by timestamp with configurable tolerance (default ±1 second)
2. **Language Tagging**: Each text span includes proper `xml:lang` attribute
3. **UTF-8 Encoding**: Full Unicode support for all languages
4. **W3C Compliant**: Follows TTML1 specification for maximum compatibility

## Testing the Converter

Try converting the example files:

```bash
cd /home/user/livevtt/examples

# Convert the sample files
python ../src/python/tools/vtt_to_ttml.py \
    --vtt_ru sample.ru.vtt \
    --vtt_en sample.en.vtt \
    --output output.ttml \
    --verbose

# Compare output with the reference sample.ttml
diff -u sample.ttml output.ttml
```

## Timestamp Alignment

The converter handles minor timestamp mismatches:

- **Default tolerance**: ±1.0 seconds
- **Configurable**: Use `--tolerance` flag to adjust
- **Warnings**: Logs unaligned cues that exceed tolerance

Example with mismatched timestamps:

```
# VTT 1: 00:00:05.000 --> 00:00:07.000
# VTT 2: 00:00:05.300 --> 00:00:07.300
# Result: Aligned (difference < 1s)
```

## Validation

The converter validates:
- VTT file existence and readability
- WEBVTT header presence
- Cue count and alignment quality
- XML structure validity

Warnings are logged for:
- Missing WEBVTT headers
- Unaligned cue pairs
- Significant timestamp mismatches

## Use Cases

1. **Video Streaming**: Bilingual subtitles for multilingual audiences
2. **Accessibility**: Combined subtitles for translation comparison
3. **Archive**: Single file format for bilingual content
4. **Post-Processing**: Easy conversion of existing subtitle pairs

## Dependencies

The TTML functionality requires:
- Python 3.10+
- Standard library only (xml.etree.ElementTree, argparse, etc.)
- No external dependencies for TTML generation

## Further Reading

- [W3C TTML1 Specification](https://www.w3.org/TR/ttml1/)
- [WebVTT Specification](https://www.w3.org/TR/webvtt1/)
- [LiveVTT Documentation](../docs/TOOLS.md)
